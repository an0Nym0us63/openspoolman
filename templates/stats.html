{% extends "base.html" %}
{% block content %}
<div class="container my-4">

  <!-- Filtres de p√©riode -->
  <form method="get" class="d-flex justify-content-center mb-4 flex-wrap gap-2">
    {% for key, label in {
      'all': 'Tout',
      'day': 'Aujourd‚Äôhui',
      '7d': '7 derniers jours',
      '1m': 'Dernier mois',
      '1y': 'Derni√®re ann√©e'
    }.items() %}
      <button type="submit" name="period" value="{{ key }}"
              class="btn btn-sm {% if selected_period == key %}btn-primary{% else %}btn-outline-secondary{% endif %}">
        {{ label }}
      </button>
    {% endfor %}
  </form>

  <!-- Statistiques -->
  <div class="row g-3">
    {% set cards = [
      ('üñ® Nombre d‚Äôimpressions', stats.total_prints),
      ('‚è± Temps total', stats.total_duration | default(0) | round(1)),
      ('‚öñÔ∏è Poids total', stats.total_weight | default(0) | round(1)),
      ('üí∞ Co√ªt filament', stats.filament_cost | default(0) | round(2)),
      ('‚ö° Co√ªt √©lectricit√©', stats.electric_cost | default(0) | round(2)),
      ('üíµ Co√ªt total', stats.total_cost | default(0) | round(2))
    ] %}

    {% for label, value in cards %}
    <div class="col-6 col-md-4 col-lg-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body text-center">
          <h6 class="card-title small text-muted">{{ label }}</h6>
          <p class="card-text fs-5 fw-bold">
            {% if 'Co√ªt' in label %}
              {{ value }} {{ currencysymbol }}
            {% elif 'Temps' in label %}
              {{ value }} h
            {% elif 'Poids' in label %}
              {{ value }} g
            {% else %}
              {{ value }}
            {% endif %}
          </p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  {% if stats.timeline %}
  <hr class="my-4">
  <div class="card shadow-sm mt-4">
  <div class="card-body">
    <h6 class="card-title text-muted text-center mb-3">Quantit√© de filament utilis√©e</h6>
    <div style="height: 300px;">
      <canvas id="filamentChart"></canvas>
    </div>
  </div>
</div>
  </div>
  {% endif %}

</div>

{% if stats.timeline %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const filamentCtx = document.getElementById('filamentChart').getContext('2d');
  const filamentChart = new Chart(filamentCtx, {
    type: 'bar',
    data: {
      labels: {{ timeline.labels|tojson }},
      datasets: [{
        label: 'Grammage total',
        data: {{ timeline.values|tojson }},
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: {
          ticks: {
            maxRotation: 60,
            minRotation: 0
          }
        },
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Grammes'
          }
        }
      },
      plugins: {
        legend: {
          display: false
        }
      }
    }
  });
</script>
{% endif %}
{% endblock %}
