{% extends 'base.html' %}

{% block content %}

<div class="accordion" id="filamentsAccordion">
  {% for spool in filaments %}
    <div class="accordion-item">
      <h2 class="accordion-header" id="heading{{ spool.id }}">
        <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse"
                data-bs-target="#collapse{{ spool.id }}" aria-expanded="false"
                aria-controls="collapse{{ spool.id }}">
          <div class="d-flex w-100 align-items-stretch">

            <div class="me-3 d-flex align-items-stretch">
              {% if spool.filament.multi_color_hexes %}
                {% set colors = spool.filament.multi_color_hexes.split(",") if spool.filament.multi_color_hexes is string else spool.filament.multi_color_hexes %}
                <span style="width: 12px; min-height: 100%; background: linear-gradient(90deg {% for c in colors %}, #{{ c.strip() }}{% endfor %}); border-radius: 2px; border: 1px solid #888;"></span>
              {% else %}
                <span style="width: 12px; min-height: 100%; background-color: #{{ spool.filament.color_hex }}; border-radius: 2px; border: 1px solid #888;"></span>
              {% endif %}
            </div>

            <div class="flex-grow-1 text-start">
              <div><strong>{{ spool.filament.material }}</strong> / {{ spool.filament.name }}</div>
              <div>{{ spool.filament.vendor.name }}</div>
            </div>

            <div class="d-flex flex-column justify-content-center align-items-end ms-2 text-end">
              {% if spool.location %}
                <div class="small text-muted">{{ spool.location }}</div>
              {% endif %}
              <strong>{{ spool.remaining_weight|round|int }}‚ÄØg</strong>
            </div>

          </div>
        </button>
      </h2>

      <div id="collapse{{ spool.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ spool.id }}" data-bs-parent="#filamentsAccordion">
        <div class="accordion-body">
          <!-- d√©tails spool -->
        </div>
      </div>
    </div>
  {% endfor %}
</div>

{% endblock %}

{% block extra_floating %}

<!-- Bouton filtres flottant -->
<div class="position-fixed bottom-0 start-0 m-2" style="z-index:1030;">
  <button class="btn btn-outline-secondary btn-sm rounded-circle" type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse" aria-expanded="false" aria-controls="filtersCollapse">
    üîç
  </button>
</div>

<!-- Zone flottante filtres -->
<div class="position-fixed bottom-0 start-50 translate-middle-x mb-5" style="z-index:1029; max-width: 95%;">
  <div class="collapse" id="filtersCollapse">
    <div class="bg-body rounded shadow p-3" style="min-height: 180px;">
      <form method="get" class="row g-2">
        <div class="col-md-4">
          <input type="text" name="search" class="form-control" placeholder="Recherche nom, mat√©riau ou vendor" value="{{ search }}">
        </div>
        <input type="hidden" name="page" value="1">
        <div class="col-md-3">
          <select name="color" class="form-select select2">
            <option value="">‚Äî Famille couleur ‚Äî</option>
            {% for fam in all_families %}
              <option value="{{ fam }}" {% if fam == selected_family %}selected{% endif %}>{{ fam }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <select name="sort" class="form-select">
            <option value="default" {% if sort != 'remaining' %}selected{% endif %}>Trier par nom</option>
            <option value="remaining" {% if sort == 'remaining' %}selected{% endif %}>Trier par stock</option>
          </select>
        </div>
        <div class="col-md-2 text-end">
          <button type="submit" class="btn btn-primary">Appliquer</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Bouton pagination flottant -->
<div class="position-fixed bottom-0 end-0 m-2" style="z-index:1030;">
  <button class="btn btn-outline-primary btn-sm rounded-circle" type="button" data-bs-toggle="collapse" data-bs-target="#paginationCollapse" aria-expanded="false" aria-controls="paginationCollapse">
    üìÑ
  </button>
</div>

<!-- Zone flottante pagination -->
<div class="position-fixed bottom-0 start-50 translate-middle-x mb-2" style="z-index:1029; max-width: 90%;">
  <div class="collapse" id="paginationCollapse">
    <div class="bg-body rounded shadow p-2">
      <div class="pagination pagination-sm mb-0 justify-content-center flex-wrap gap-1">
        {% if page > 1 %}
          <a href="{{ url_with_args(page=1) }}" class="btn btn-outline-primary btn-sm rounded-pill">&laquo; 1</a>
          <a href="{{ url_with_args(page=page-1) }}" class="btn btn-outline-primary btn-sm rounded-pill">&lsaquo; {{ page-1 }}</a>
        {% endif %}

        <span class="mx-2 small">
          Page {{ page }} / {{ total_pages }}
        </span>

        {% if page < total_pages %}
          <a href="{{ url_with_args(page=page+1) }}" class="btn btn-outline-primary btn-sm rounded-pill">{{ page+1 }} &rsaquo;</a>
          <a href="{{ url_with_args(page=total_pages) }}" class="btn btn-outline-primary btn-sm rounded-pill">{{ total_pages }} &raquo;</a>
        {% endif %}

        <form method="get" class="d-inline ms-3">
          <input type="hidden" name="search" value="{{ search }}">
          <input type="hidden" name="color" value="{{ selected_family }}">
          <input type="hidden" name="sort" value="{{ sort }}">
          <input type="number" min="1" max="{{ total_pages }}" name="page" value="{{ page }}" class="form-control form-control-sm d-inline-block" style="width:70px;">
          <button type="submit" class="btn btn-sm btn-primary ms-1">Aller</button>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="{{ url_for('static', filename='js/print_history.js') }}"></script>
{% endblock %}